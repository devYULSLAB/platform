root/
├─ settings.gradle                  # include 'common-*', 'platform10', 'cmms10', 'wflow10', 'market10', 'mportal10'
├─ build.gradle                     # Java 24 toolchain, 공통 의존 관리
├─ gradle.properties
├─ gradlew / gradlew.bat
├─ gradle/wrapper/gradle-wrapper.{jar,properties}
├─ scripts/
│  ├─ run-dev.bat                   # Windows 개발 실행
│  └─ run-prod.sh                   # Linux 배포 실행
│
├─ common-core/
│  ├─ build.gradle
│  └─ src/main/resources/
│     ├─ db/migration/             # (선택) 공통 마이그레이션
│     └─ i18n/messages_{ko,en}.properties
│
├─ common-web/
│  ├─ build.gradle
│  └─ src/main/resources/templates/
│     ├─ layout/defaultLayout.html  # 공통 프레임 + app-nav 슬롯
│     └─ fragments/
│        ├─ appSwitcher.html        # 우측 하단 앱 전환
│        ├─ fileListFragment.html   # 상세(detail) 전용 – 조회만
│        └─ fileUploadFragment.html # 폼(form) 전용 – 업로드 입력
│
├─ common-security/
│  ├─ build.gradle
│  └─ src/main/java/com/platform/common/security/
│     ├─ config/SecurityConfig.java
│     ├─ config/WebMvcConfig.java               # 인터셉터 등록
│     ├─ config/CompanyContextInterceptor.java  # 회사 스코프 강제·검증 + MDC
│     ├─ entity/{Company,Site,Dept,UserAccount,Role,UserRole}.java  # @Table(schema="platform")
│     ├─ repository/**.java
│     └─ service/**.java
│     └─ resources/
│        ├─ templates/login.html
│        └─ db/migration/
│           ├─ V1__platform_core.sql   # company/site/dept/user/role/user_role
│           └─ V2__indexes.sql
│
├─ platform10/                      # 플랫폼 관리자 전용(간단 CRUD)
│  ├─ build.gradle
│  └─ src/main/{java,resources}
│     ├─ Platform10Application.java
│     ├─ admin/controller/**        # Company/Site/Dept/User/Role 단순 CRUD
│     ├─ application.yml            # App Switcher URL, 부트스트랩 토글 주석
│     └─ templates/admin/**         # home + 각 CRUD 최소 화면
│
├─ cmms10/                          # CMMS 업무 앱(독립)
│  ├─ build.gradle
│  └─ src/main/{java,resources}
│     ├─ Cmms10Application.java
│     ├─ .../workpermit/controller/**.java  # 화면 컨트롤러 패턴 준수
│     ├─ resources/db/migration/            # cmms 전용 DDL(Flyway)
│     └─ templates/
│        ├─ layout/cmmsLayout.html          # 모듈 전용 상단 메뉴(app-nav)
│        └─ workpermit/{List,Form,Detail}.html
│
├─ wflow10/   # 동일 패턴
├─ market10/  # 동일 패턴
└─ mportal10/ # 동일 패턴

B) 데이터베이스 분리 원칙

공통 스키마(platform): 회사·사이트·부서·사용자·권한만 단일 관리

테이블: platform.company/site/dept/user_account/role/user_role

모든 앱은 교차 스키마 참조: 엔티티에 @Table(schema="platform")

업무 스키마(예: cmms): 업무 도메인 테이블 전용

규칙: company를 제외한 모든 테이블의 PK는 (company_id, xxx_id) 복합 PK

CMMS 구성: memo, inspection, workorder, workpermit,
plant_master + func_master(기능위치), inventory_master + loc_master(저장위치),
코드관리(code_type, code: JOBTP/ASSET/DEPRE/PERMT 등)

CMMS 예시 DDL(요약)

cmms.code_type(company_id, code_type) PK

cmms.code(company_id, code_id) PK + FK(company_id, code_type)

cmms.plant_master(company_id, plant_id) PK

cmms.func_master(company_id, func_id) PK (+ self FK)

cmms.inventory_master(company_id, item_id) PK

cmms.loc_master(company_id, loc_id) PK

cmms.memo(company_id, memo_id) PK

cmms.inspection(company_id, inspection_id) PK

cmms.workorder(company_id, workorder_id) PK

cmms.workpermit(company_id, permit_id) PK

C) 보안/세션/스코프 강제

로그인·권한: common-security

권한 계층: ROLE_PLATFORM_ADMIN > ROLE_COMPANY_ADMIN > ROLE_USER

CompanyContextInterceptor 역할:

세션에 companyId 없으면 /company/select로 유도

platform.user_role 기준으로 (username, companyId) 매핑 존재 시 접근 허용

요청 파라미터의 companyId는 무시하고 서버가 강제 세팅

MDC(companyId, username) 주입 → 전 구간 로그에 자동 표기

컨트롤러·서비스는 항상 세션에서 companyId를 읽어 서버단에서 필드 덮어쓰기

D) 레이아웃/전환/파일 프래그먼트

공통 레이아웃: defaultLayout.html (+ layout:fragment="app-nav" 슬롯 제공)

모듈 전용 레이아웃: {module}Layout.html에서 상단 메뉴 구성

하단 전환: fragments/appSwitcher.html (다른 앱 URL을 yml에서 주입)

파일 UI 정책:

detail.html: fileListFragment(조회만, 삭제/추가 버튼 없음)

form.html : fileUploadFragment(업로드 입력만)

E) 빌드/배포/포트

Java 24 Toolchain 고정, Gradle Wrapper 8.10+

프로필: application-dev.yml(개발), application-prod.yml(운영)

스크립트: scripts/run-dev.bat, scripts/run-prod.sh

포트 예시: platform10=9005, cmms10=9010, wflow10=9020, market10=9030, mportal10=9040

F) 최초 관리자/부트스트랩

SQL 시드(권장): platform.company/role/user_account/user_role 직접 INSERT

user_account.password는 BCrypt 해시만 저장

대안: platform10에 1회성 CommandLineRunner(환경변수 토글)로 admin 생성

적용 후 반드시 토글 비활성화

G) 코드 생성 시 상수 규약(요지)

모든 업무 테이블 복합 PK: (companyId, domainId)

Repository 메서드: findByCompanyId..., existsByCompanyIdAnd... 우선

화면 컨트롤러 메서드: list/form/editForm/detail/save/update/delete 고정

템플릿 경로: templates/{feature}/{feature}{List|Form|Detail}.html

파일 프래그먼트 사용 규칙(위 D 항목) 준수